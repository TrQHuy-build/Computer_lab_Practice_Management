@model HocKyViewModel
@{
    ViewData["Title"] = "Sửa học kỳ";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-pencil-square me-2"></i>Sửa thông tin học kỳ
            </div>
            <div class="card-body">
                <form asp-action="Sua" method="post">
                    <input type="hidden" asp-for="Id" />
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label asp-for="TenHocKy" class="form-label">Tên học kỳ <span class="text-danger">*</span></label>
                            <input asp-for="TenHocKy" class="form-control" placeholder="VD: HK1 2025-2026" required />
                            <span asp-validation-for="TenHocKy" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="NamHoc" class="form-label">Năm học <span class="text-danger">*</span></label>
                            <input asp-for="NamHoc" class="form-control" placeholder="VD: 2025-2026" required />
                            <span asp-validation-for="NamHoc" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="SoHocKy" class="form-label">Số học kỳ <span class="text-danger">*</span></label>
                            <select asp-for="SoHocKy" class="form-select" required>
                                <option value="1">Học kỳ 1</option>
                                <option value="2">Học kỳ 2</option>
                                <option value="3">Học kỳ hè</option>
                            </select>
                            <span asp-validation-for="SoHocKy" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="TrangThai" class="form-label">Trạng thái</label>
                            <select asp-for="TrangThai" class="form-select">
                                <option value="0">Không hoạt động</option>
                                <option value="1">Đang hoạt động</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Hướng dẫn:</strong> Nhập ngày bắt đầu và kết thúc học kỳ. 
                        Hệ thống sẽ tự động tính:
                        <ul class="mb-0 mt-2">
                            <li>4 tuần trước học kỳ (tiền học kỳ)</li>
                            <li>3 tuần cuối (giai đoạn thi, không có thực hành)</li>
                        </ul>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="BatDauHocKy" class="form-label">Ngày bắt đầu học kỳ <span class="text-danger">*</span></label>
                            <input asp-for="BatDauHocKy" type="date" class="form-control" id="ngayBatDau" required />
                            <span asp-validation-for="BatDauHocKy" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="KetThucHocKy" class="form-label">Ngày kết thúc học kỳ <span class="text-danger">*</span></label>
                            <input asp-for="KetThucHocKy" type="date" class="form-control" id="ngayKetThuc" required />
                            <span asp-validation-for="KetThucHocKy" class="text-danger"></span>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ngày bắt đầu tiền học kỳ</label>
                            <input asp-for="TienHocKy" type="date" class="form-control" readonly id="ngayTienHocKy" />
                            <small class="text-muted">Tự động tính (4 tuần trước)</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ngày bắt đầu giai đoạn thi</label>
                            <input type="date" class="form-control" readonly id="ngayThi" />
                            <small class="text-muted">Tự động tính (3 tuần trước kết thúc)</small>
                        </div>
                    </div>
                    
                    <hr />
                    
                    <div class="d-flex justify-content-between">
                        <a href="/QuanLyHocKy" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i>Quay lại
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg me-1"></i>Lưu thay đổi
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function updateDates() {
            var ngayBatDau = document.getElementById('ngayBatDau').value;
            var ngayKetThuc = document.getElementById('ngayKetThuc').value;
            
            if (ngayBatDau) {
                var date = new Date(ngayBatDau);
                date.setDate(date.getDate() - 28); // 4 tuần trước
                document.getElementById('ngayTienHocKy').value = date.toISOString().split('T')[0];
            }
            
            if (ngayKetThuc) {
                var date = new Date(ngayKetThuc);
                date.setDate(date.getDate() - 21); // 3 tuần trước
                document.getElementById('ngayThi').value = date.toISOString().split('T')[0];
            }
        }
        
        document.getElementById('ngayBatDau').addEventListener('change', updateDates);
        document.getElementById('ngayKetThuc').addEventListener('change', updateDates);
        
        // Cập nhật khi load trang
        updateDates();
    </script>
}
